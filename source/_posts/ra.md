---
title: ra
date: 2021-04-13 10:45:34
categories:
- erlang
tags: raft
---
    ra是由rabbitmq团队正在开发的轻量级分布式erlang集群，旨在解决分布式一致性问题，分布式集群一般分为中心华的和去中心华的，
中心化使用的算法有Paxos、raft(Paxos算法的变种),raft算法更易于理解和实现。用raft实现的服务发现的程序consul、ectd等都是raft实现的。
本文主要介绍raft在erlang中的实现，主要分析ra源码，对raft算法的具体概念请自行查阅相关文献。

## 工具和环境

- rebar 3.14.4 on Erlang/OTP 22 Erts 10.7.2.1
- [ra简单kv-store使用例子](https://github.com/rabbitmq/ra-kv-store.git)
- [ra-1.1.9](https://github.com/rabbitmq/ra.git)
- [调试跟踪工具 recon-2.5.1](https://github.com/ferd/recon)

## 源码跟踪分析

### 分析回调

- 回调注册： 
```erlang
    Servers =  [{ra_kv1, 'ra_kv_store@127.0.0.1'}],
    ClusterId = <<"ra_kv_store">>,
    Config = #{},
    %% ra_kv_store是回调模块，实现了ra_machine behavior
    Machine = {module, ra_kv_store, Config},
   {ok, Started, Failed} = ra:start_cluster(default, ClusterId, Machine, Servers),
```
- process_command回调方法:
```erlang

   init(_Config) ->
       #{}.
    %% 执行 ra:process_command(ra_kv1, {write, Key, Value})  
    %% 会回调该方法
   apply(#{index := Index, term := Term} = _Metadata, {write, Key, Value}, State) ->
       NewState = maps:put(Key, Value, State),
       SideEffects = side_effects(Index, NewState),
       %% return the index and term here as a result
       {NewState, {Index, Term}, SideEffects};
       %% 执行 ra:process_command(ra_kv1, {cas, Key, ExpectedValue, NewValue})
       %% 会回调该方法
   apply(#{index := Index, term := Term} = _Metadata,
         {cas, Key, ExpectedValue, NewValue},
         State) ->
       {NewState, ReadValue} =
           case maps:get(Key, State, undefined) of
               ExpectedValue ->
                   {maps:put(Key, NewValue, State), ExpectedValue};
               ValueInStore ->
                   {State, ValueInStore}
           end,
       SideEffects = side_effects(Index, NewState),
       {NewState, {{read, ReadValue}, {index, Index}, {term, Term}}, SideEffects}.
  ```
- 跟踪方法：
```erlang
{ok, Dev} = file:open("/tmp/trace",[write]).                   
recon_trace:calls([{ra_server_proc, leader, fun([_, T, _]) when T /= tick_timeout -> return_trace end},{ra_server_proc, gen_statem_safe_call, return_trace},{ra_kv_store, '_', return_trace},{ra, process_command, return_trace}, {ra_server_proc,command, return_trace}, {ra_server_proc, leader_call, return_trace},{ra_server_proc,handle_leader, return_trace},{ra_server, handle_leader, return_trace},{ra_log,handle_event, return_trace},{ra_server, evaluate_quorum, return_trace},{ra_server, apply_with, return_trace},{ra_machine, apply, return_trace}, {ra_log_wal, '_', return_trace},{ra_server_proc, handle_effects, fun([_, _, {call, _}, _, _]) -> return_trace end},{ra_server_proc, handle_effect, fun([_,{send_rpc, _, _},_,_,_]) -> return_trace end},{ra_server_proc, send, return_trace}], 500, [{scope, local},{io_server, Dev}]).


$cat /tmp/trace

```erlang

18:4:15.090365 <0.2624.0> ra_kv_store:write(ra_kv1, <<"a">>, <<"2">>)

18:4:15.090878 <0.2624.0> ra:process_command(ra_kv1, {write,<<"a">>,<<"2">>})

18:4:15.091004 <0.2624.0> ra:process_command(ra_kv1, {write,<<"a">>,<<"2">>}, 5000)

18:4:15.091131 <0.2624.0> ra_server_proc:command(ra_kv1, {'$usr',{write,<<"a">>,<<"2">>},await_consensus}, 5000)

18:4:15.091429 <0.2624.0> ra_server_proc:leader_call(ra_kv1, {command,normal,{'$usr',{write,<<"a">>,<<"2">>},await_consensus}}, 5000)

18:4:15.102065 <0.2624.0> ra_server_proc:gen_statem_safe_call(ra_kv1, {leader_call,{command,normal,
                      {'$usr',{write,<<"a">>,<<"2">>},await_consensus}}}, 5000)

18:4:15.102492 <0.554.0> ra_server_proc:leader({call,{<0.2625.0>,#Ref<0.4247252258.4035444737.61292>}}, {leader_call,{command,normal,
                      {'$usr',{write,<<"a">>,<<"2">>},await_consensus}}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 6,next_index => 7,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,6,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0})

18:4:15.105147 <0.554.0> ra_server_proc:leader({call,{<0.2625.0>,#Ref<0.4247252258.4035444737.61292>}}, {command,normal,{'$usr',{write,<<"a">>,<<"2">>},await_consensus}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 6,next_index => 7,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,6,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0})

18:4:15.108365 <0.554.0> ra_server:handle_leader({command,{'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                   ts => 1618308255090},
                 {write,<<"a">>,<<"2">>},
                 await_consensus}}, #{aux_state=>undefined, cfg=>{cfg,{ra_kv1,'ra_kv_store1@127.0.0.1'},
     <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
     {machine,ra_kv_store,#{}},
     0,
     [{0,0}],
     0,ra_kv_store,4096,
     {atomics,#Ref<0.4247252258.4035575810.46285>},
     #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",name => default,
       names =>
           #{closed_mem_tbls => ra_log_closed_mem_tables,
             directory => ra_directory,directory_rev => ra_directory_reverse,
             log_ets => ra_log_ets,log_meta => ra_log_meta,
             log_sup => ra_log_sup,open_mem_tbls => ra_log_open_mem_tables,
             segment_writer => ra_log_segment_writer,
             server_sup => ra_server_sup_sup,wal => ra_log_wal,
             wal_sup => ra_log_wal_sup},
       segment_max_entries => 4096,wal_compute_checksums => true,
       wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
       wal_max_batch_size => 8192,wal_max_entries => undefined,
       wal_max_size_bytes => 256000000,wal_sync_method => datasync,
       wal_write_strategy => default}}, cluster=>#{{ra_kv1,'ra_kv_store1@127.0.0.1'}=>#{commit_index_sent=>0, match_index=>0, next_index=>1, query_index=>0, status=>normal}, {ra_kv2,'ra_kv_store2@127.0.0.1'}=>#{commit_index_sent=>6, match_index=>6, next_index=>7, query_index=>0, status=>normal}}, cluster_change_permitted=>true, cluster_index_term=>{0,0}, commit_index=>6, commit_latency=>16, current_term=>1, last_applied=>6, leader_id=>{ra_kv1,'ra_kv_store1@127.0.0.1'}, log=>{ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
             4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
             {atomics,#Ref<0.4247252258.4035575810.46285>},
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
        0,6,1,
        {6,1},
        {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                     "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                     undefined,undefined,undefined},
        #{},undefined,
        {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                            {atomics,#Ref<0.4247252258.4035575810.46285>},
                            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                            ra_log_open_mem_tables,ra_log_closed_mem_tables},
                       0,[],
                       {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
        []}, machine_state=>#{<<"a">>=><<"2">>}, pending_consistent_queries=>[], persisted_last_applied=>6, pre_vote_token=>#Ref<0.4247252258.4035444738.46318>, queries_waiting_heartbeats=>{[],[]}, query_index=>0, voted_for=>{ra_kv1,'ra_kv_store1@127.0.0.1'}})

18:4:15.110420 <0.554.0> ra_log_wal:write({<<"RA_KV_4K9N2O5QOHEB">>,<0.554.0>}, ra_log_wal, 7, 1, {'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
          ts => 1618308255090},
        {write,<<"a">>,<<"2">>},
        await_consensus})

18:4:15.110735 <0.554.0> ra_log_wal:named_cast(ra_log_wal, {append,{<<"RA_KV_4K9N2O5QOHEB">>,<0.554.0>},
        7,1,
        {'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                  ts => 1618308255090},
                {write,<<"a">>,<<"2">>},
                await_consensus}})

18:4:15.111202 <0.554.0> ra_log_wal:named_cast(<0.542.0>, {append,{<<"RA_KV_4K9N2O5QOHEB">>,<0.554.0>},
        7,1,
        {'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                  ts => 1618308255090},
                {write,<<"a">>,<<"2">>},
                await_consensus}})

18:4:15.111486 <0.554.0> ra_log_wal:named_cast/2 --> ok

18:4:15.111600 <0.554.0> ra_log_wal:named_cast/2 --> ok

18:4:15.111679 <0.554.0> ra_log_wal:write/5 --> ok

18:4:15.111754 <0.554.0> ra_server:handle_leader/2 --> {leader,
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 6,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{7 =>
                    {7,1,
                     {'$usr',
                         #{from =>
                               {<0.2625.0>,
                                #Ref<0.4247252258.4035444737.61292>},
                           ts => 1618308255090},
                         {write,<<"a">>,<<"2">>},
                         await_consensus}}},
              undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    [{send_rpc,
         {ra_kv2,'ra_kv_store2@127.0.0.1'},
         {append_entries_rpc,1,
             {ra_kv1,'ra_kv_store1@127.0.0.1'},
             6,6,1,
             [{7,1,
               {'$usr',
                   #{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                     ts => 1618308255090},
                   {write,<<"a">>,<<"2">>},
                   await_consensus}}]}}]}

18:4:15.126833 <0.554.0> ra_server_proc:handle_effects(leader, [{send_rpc,
     {ra_kv2,'ra_kv_store2@127.0.0.1'},
     {append_entries_rpc,1,
         {ra_kv1,'ra_kv_store1@127.0.0.1'},
         6,6,1,
         [{7,1,
           {'$usr',
               #{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                 ts => 1618308255090},
               {write,<<"a">>,<<"2">>},
               await_consensus}}]}}], {call,{<0.2625.0>,#Ref<0.4247252258.4035444737.61292>}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 6,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{7 =>
                    {7,1,
                     {'$usr',
                         #{from =>
                               {<0.2625.0>,
                                #Ref<0.4247252258.4035444737.61292>},
                           ts => 1618308255090},
                         {write,<<"a">>,<<"2">>},
                         await_consensus}}},
              undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0}, [])

18:4:15.129554 <0.554.0> ra_server_proc:handle_effect(leader, {send_rpc,
    {ra_kv2,'ra_kv_store2@127.0.0.1'},
    {append_entries_rpc,1,
        {ra_kv1,'ra_kv_store1@127.0.0.1'},
        6,6,1,
        [{7,1,
          {'$usr',
              #{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                ts => 1618308255090},
              {write,<<"a">>,<<"2">>},
              await_consensus}}]}}, {call,{<0.2625.0>,#Ref<0.4247252258.4035444737.61292>}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 6,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{7 =>
                    {7,1,
                     {'$usr',
                         #{from =>
                               {<0.2625.0>,
                                #Ref<0.4247252258.4035444737.61292>},
                           ts => 1618308255090},
                         {write,<<"a">>,<<"2">>},
                         await_consensus}}},
              undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0}, [])

18:4:15.132193 <0.554.0> ra_server_proc:send({ra_kv2,'ra_kv_store2@127.0.0.1'}, {'$gen_cast',
    {append_entries_rpc,1,
        {ra_kv1,'ra_kv_store1@127.0.0.1'},
        6,6,1,
        [{7,1,
          {'$usr',
              #{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                ts => 1618308255090},
              {write,<<"a">>,<<"2">>},
              await_consensus}}]}}, {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,1000,
      30000,undefined,25,1000000,30000,1000,
      {atomics,#Ref<0.4247252258.4035575810.46285>}})

18:4:15.132627 <0.554.0> ra_server_proc:send/3 --> ok

18:4:15.132713 <0.542.0> ra_log_wal:handle_batch([{cast,{append,{<<"RA_KV_4K9N2O5QOHEB">>,<0.554.0>},
               7,1,
               {'$usr',#{from =>
                             {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                         ts => 1618308255090},
                       {write,<<"a">>,<<"2">>},
                       await_consensus}}}], {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       undefined})

18:4:15.133543 <0.542.0> ra_log_wal:start_batch({state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       undefined})

18:4:15.134574 <0.542.0> ra_log_wal:start_batch/1 --> {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       {batch,0,#{},[]}}

18:4:15.135381 <0.542.0> ra_log_wal:'-handle_batch/2-lists^foldr/2-0-'([{cast,{append,{<<"RA_KV_4K9N2O5QOHEB">>,<0.554.0>},
               7,1,
               {'$usr',#{from =>
                             {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                         ts => 1618308255090},
                       {write,<<"a">>,<<"2">>},
                       await_consensus}}}], {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       {batch,0,#{},[]}}, #Fun<ra_log_wal.0.92771864>)

18:4:15.136257 <0.542.0> ra_log_wal:'-handle_batch/2-lists^foldr/2-0-'([], {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       {batch,0,#{},[]}}, #Fun<ra_log_wal.0.92771864>)

18:4:15.137137 <0.542.0> ra_log_wal:'-handle_batch/2-lists^foldr/2-0-'/3 --> {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       {batch,0,#{},[]}}

18:4:15.137911 <0.542.0> ra_log_wal:handle_msg({append,{<<"RA_KV_4K9N2O5QOHEB">>,<0.554.0>},
        7,1,
        {'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                  ts => 1618308255090},
                {write,<<"a">>,<<"2">>},
                await_consensus}}, {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       {batch,0,#{},[]}})

18:4:15.138776 <0.542.0> ra_log_wal:write_data({<<"RA_KV_4K9N2O5QOHEB">>,<0.554.0>}, 7, 1, {'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
          ts => 1618308255090},
        {write,<<"a">>,<<"2">>},
        await_consensus}, false, {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       {batch,0,#{},[]}})

18:4:15.139894 <0.542.0> ra_log_wal:serialize_header(<<"RA_KV_4K9N2O5QOHEB">>, false, {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}})

18:4:15.140083 <0.542.0> ra_log_wal:serialize_header/3 --> {<<64,0,0>>,2,{1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}}}

18:4:15.140223 <0.542.0> ra_log_wal:should_roll_wal(180, {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,7},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       {batch,0,#{},[]}})

18:4:15.140889 <0.542.0> ra_log_wal:should_roll_wal/2 --> false

18:4:15.140993 <0.542.0> ra_log_wal:append_data({state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,8},
       1016,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,6}},
       {batch,0,#{},[]}}, {<<"RA_KV_4K9N2O5QOHEB">>,<0.554.0>}, 7, 1, {'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
          ts => 1618308255090},
        {write,<<"a">>,<<"2">>},
        await_consensus}, 180, [<<64,0,0>>,
 <<44,43,42,54,0,0,0,154>>,
 [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
  <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,111,109,104,
    2,103,100,0,22,114,97,95,107,118,95,115,116,111,114,101,49,64,49,50,55,
    46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,114,0,3,100,0,22,114,97,95,107,118,
    95,115,116,111,114,101,49,64,49,50,55,46,48,46,48,46,49,3,0,0,239,108,
    240,136,0,1,253,39,237,34,100,0,2,116,115,110,6,0,114,77,176,202,120,1,
    104,3,100,0,5,119,114,105,116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,
    97,119,97,105,116,95,99,111,110,115,101,110,115,117,115>>]], false)

18:4:15.142052 <0.542.0> ra_log_wal:incr_batch({conf,[raw,write,read,binary],
      "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,true,
      256000000,undefined,33554432,default,datasync,
      {atomics,#Ref<0.4247252258.4035575810.46192>},
      ra_log_open_mem_tables,ra_log_closed_mem_tables,
      #{closed_mem_tbls => ra_log_closed_mem_tables,directory => ra_directory,
        directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
        log_meta => ra_log_meta,log_sup => ra_log_sup,
        open_mem_tbls => ra_log_open_mem_tables,
        segment_writer => ra_log_segment_writer,
        server_sup => ra_server_sup_sup,wal => ra_log_wal,
        wal_sup => ra_log_wal_sup}}, {batch,0,#{},[]}, <<"RA_KV_4K9N2O5QOHEB">>, <0.554.0>, {7,1}, [<<64,0,0>>,
 <<44,43,42,54,0,0,0,154>>,
 [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
  <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,111,109,104,
    2,103,100,0,22,114,97,95,107,118,95,115,116,111,114,101,49,64,49,50,55,
    46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,114,0,3,100,0,22,114,97,95,107,118,
    95,115,116,111,114,101,49,64,49,50,55,46,48,46,48,46,49,3,0,0,239,108,
    240,136,0,1,253,39,237,34,100,0,2,116,115,110,6,0,114,77,176,202,120,1,
    104,3,100,0,5,119,114,105,116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,
    97,119,97,105,116,95,99,111,110,115,101,110,115,117,115>>]], {'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
          ts => 1618308255090},
        {write,<<"a">>,<<"2">>},
        await_consensus}, false)

18:4:15.142799 <0.542.0> ra_log_wal:incr_batch/8 --> {batch,1,
       #{<0.554.0> =>
             {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,
                           #Ref<0.4247252258.4035575810.46294>,7,7,1,
                           [{7,1,
                             {'$usr',#{from =>
                                           {<0.2625.0>,
                                            #Ref<0.4247252258.4035444737.61292>},
                                       ts => 1618308255090},
                                     {write,<<"a">>,<<"2">>},
                                     await_consensus}}]}},
       [[],
        <<64,0,0>>,
        <<44,43,42,54,0,0,0,154>>,
        [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
         <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,111,
           109,104,2,103,100,0,22,114,97,95,107,118,95,115,116,111,114,101,
           49,64,49,50,55,46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,114,0,3,100,
           0,22,114,97,95,107,118,95,115,116,111,114,101,49,64,49,50,55,46,
           48,46,48,46,49,3,0,0,239,108,240,136,0,1,253,39,237,34,100,0,2,
           116,115,110,6,0,114,77,176,202,120,1,104,3,100,0,5,119,114,105,
           116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,97,119,97,105,116,
           95,99,111,110,115,101,110,115,117,115>>]]}

18:4:15.143401 <0.542.0> ra_log_wal:append_data/8 --> {state,
    {conf,
        [raw,write,read,binary],
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,true,
        256000000,undefined,33554432,default,datasync,
        {atomics,#Ref<0.4247252258.4035575810.46192>},
        ra_log_open_mem_tables,ra_log_closed_mem_tables,
        #{closed_mem_tbls => ra_log_closed_mem_tables,
          directory => ra_directory,directory_rev => ra_directory_reverse,
          log_ets => ra_log_ets,log_meta => ra_log_meta,log_sup => ra_log_sup,
          open_mem_tbls => ra_log_open_mem_tables,
          segment_writer => ra_log_segment_writer,
          server_sup => ra_server_sup_sup,wal => ra_log_wal,
          wal_sup => ra_log_wal_sup}},
    1,
    {wal,
        {file_descriptor,prim_file,
            #{handle => #Ref<0.4247252258.4035575831.45765>,
              owner => <0.542.0>,r_ahead_size => 0,
              r_buffer => #Ref<0.4247252258.4035575810.46203>}},
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
        {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
        131300186,8},
    1196,
    #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
    {batch,1,
        #{<0.554.0> =>
              {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,
                  #Ref<0.4247252258.4035575810.46294>,7,7,1,
                  [{7,1,
                    {'$usr',
                        #{from =>
                              {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                          ts => 1618308255090},
                        {write,<<"a">>,<<"2">>},
                        await_consensus}}]}},
        [[],
         <<64,0,0>>,
         <<44,43,42,54,0,0,0,154>>,
         [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
          <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,
            111,109,104,2,103,100,0,22,114,97,95,107,118,95,115,116,111,
            114,101,49,64,49,50,55,46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,
            114,0,3,100,0,22,114,97,95,107,118,95,115,116,111,114,101,49,
            64,49,50,55,46,48,46,48,46,49,3,0,0,239,108,240,136,0,1,253,39,
            237,34,100,0,2,116,115,110,6,0,114,77,176,202,120,1,104,3,100,
            0,5,119,114,105,116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,
            97,119,97,105,116,95,99,111,110,115,101,110,115,117,115>>]]}}

18:4:15.144457 <0.542.0> ra_log_wal:write_data/6 --> {state,
    {conf,
        [raw,write,read,binary],
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,true,
        256000000,undefined,33554432,default,datasync,
        {atomics,#Ref<0.4247252258.4035575810.46192>},
        ra_log_open_mem_tables,ra_log_closed_mem_tables,
        #{closed_mem_tbls => ra_log_closed_mem_tables,
          directory => ra_directory,directory_rev => ra_directory_reverse,
          log_ets => ra_log_ets,log_meta => ra_log_meta,log_sup => ra_log_sup,
          open_mem_tbls => ra_log_open_mem_tables,
          segment_writer => ra_log_segment_writer,
          server_sup => ra_server_sup_sup,wal => ra_log_wal,
          wal_sup => ra_log_wal_sup}},
    1,
    {wal,
        {file_descriptor,prim_file,
            #{handle => #Ref<0.4247252258.4035575831.45765>,
              owner => <0.542.0>,r_ahead_size => 0,
              r_buffer => #Ref<0.4247252258.4035575810.46203>}},
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
        {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
        131300186,8},
    1196,
    #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
    {batch,1,
        #{<0.554.0> =>
              {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,
                  #Ref<0.4247252258.4035575810.46294>,7,7,1,
                  [{7,1,
                    {'$usr',
                        #{from =>
                              {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                          ts => 1618308255090},
                        {write,<<"a">>,<<"2">>},
                        await_consensus}}]}},
        [[],
         <<64,0,0>>,
         <<44,43,42,54,0,0,0,154>>,
         [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
          <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,
            111,109,104,2,103,100,0,22,114,97,95,107,118,95,115,116,111,
            114,101,49,64,49,50,55,46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,
            114,0,3,100,0,22,114,97,95,107,118,95,115,116,111,114,101,49,
            64,49,50,55,46,48,46,48,46,49,3,0,0,239,108,240,136,0,1,253,39,
            237,34,100,0,2,116,115,110,6,0,114,77,176,202,120,1,104,3,100,
            0,5,119,114,105,116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,
            97,119,97,105,116,95,99,111,110,115,101,110,115,117,115>>]]}}

18:4:15.145504 <0.542.0> ra_log_wal:handle_msg/2 --> {state,
    {conf,
        [raw,write,read,binary],
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,true,
        256000000,undefined,33554432,default,datasync,
        {atomics,#Ref<0.4247252258.4035575810.46192>},
        ra_log_open_mem_tables,ra_log_closed_mem_tables,
        #{closed_mem_tbls => ra_log_closed_mem_tables,
          directory => ra_directory,directory_rev => ra_directory_reverse,
          log_ets => ra_log_ets,log_meta => ra_log_meta,log_sup => ra_log_sup,
          open_mem_tbls => ra_log_open_mem_tables,
          segment_writer => ra_log_segment_writer,
          server_sup => ra_server_sup_sup,wal => ra_log_wal,
          wal_sup => ra_log_wal_sup}},
    1,
    {wal,
        {file_descriptor,prim_file,
            #{handle => #Ref<0.4247252258.4035575831.45765>,
              owner => <0.542.0>,r_ahead_size => 0,
              r_buffer => #Ref<0.4247252258.4035575810.46203>}},
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
        {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
        131300186,8},
    1196,
    #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
    {batch,1,
        #{<0.554.0> =>
              {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,
                  #Ref<0.4247252258.4035575810.46294>,7,7,1,
                  [{7,1,
                    {'$usr',
                        #{from =>
                              {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                          ts => 1618308255090},
                        {write,<<"a">>,<<"2">>},
                        await_consensus}}]}},
        [[],
         <<64,0,0>>,
         <<44,43,42,54,0,0,0,154>>,
         [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
          <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,
            111,109,104,2,103,100,0,22,114,97,95,107,118,95,115,116,111,
            114,101,49,64,49,50,55,46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,
            114,0,3,100,0,22,114,97,95,107,118,95,115,116,111,114,101,49,
            64,49,50,55,46,48,46,48,46,49,3,0,0,239,108,240,136,0,1,253,39,
            237,34,100,0,2,116,115,110,6,0,114,77,176,202,120,1,104,3,100,
            0,5,119,114,105,116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,
            97,119,97,105,116,95,99,111,110,115,101,110,115,117,115>>]]}}

18:4:15.146603 <0.542.0> ra_log_wal:'-handle_batch/2-lists^foldr/2-0-'/3 --> {state,
    {conf,
        [raw,write,read,binary],
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,true,
        256000000,undefined,33554432,default,datasync,
        {atomics,#Ref<0.4247252258.4035575810.46192>},
        ra_log_open_mem_tables,ra_log_closed_mem_tables,
        #{closed_mem_tbls => ra_log_closed_mem_tables,
          directory => ra_directory,directory_rev => ra_directory_reverse,
          log_ets => ra_log_ets,log_meta => ra_log_meta,log_sup => ra_log_sup,
          open_mem_tbls => ra_log_open_mem_tables,
          segment_writer => ra_log_segment_writer,
          server_sup => ra_server_sup_sup,wal => ra_log_wal,
          wal_sup => ra_log_wal_sup}},
    1,
    {wal,
        {file_descriptor,prim_file,
            #{handle => #Ref<0.4247252258.4035575831.45765>,
              owner => <0.542.0>,r_ahead_size => 0,
              r_buffer => #Ref<0.4247252258.4035575810.46203>}},
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
        {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
        131300186,8},
    1196,
    #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
    {batch,1,
        #{<0.554.0> =>
              {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,
                  #Ref<0.4247252258.4035575810.46294>,7,7,1,
                  [{7,1,
                    {'$usr',
                        #{from =>
                              {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                          ts => 1618308255090},
                        {write,<<"a">>,<<"2">>},
                        await_consensus}}]}},
        [[],
         <<64,0,0>>,
         <<44,43,42,54,0,0,0,154>>,
         [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
          <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,
            111,109,104,2,103,100,0,22,114,97,95,107,118,95,115,116,111,
            114,101,49,64,49,50,55,46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,
            114,0,3,100,0,22,114,97,95,107,118,95,115,116,111,114,101,49,
            64,49,50,55,46,48,46,48,46,49,3,0,0,239,108,240,136,0,1,253,39,
            237,34,100,0,2,116,115,110,6,0,114,77,176,202,120,1,104,3,100,
            0,5,119,114,105,116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,
            97,119,97,105,116,95,99,111,110,115,101,110,115,117,115>>]]}}

18:4:15.148245 <0.542.0> ra_log_wal:complete_batch({state,
    {conf,
        [raw,write,read,binary],
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,true,
        256000000,undefined,33554432,default,datasync,
        {atomics,#Ref<0.4247252258.4035575810.46192>},
        ra_log_open_mem_tables,ra_log_closed_mem_tables,
        #{closed_mem_tbls => ra_log_closed_mem_tables,
          directory => ra_directory,directory_rev => ra_directory_reverse,
          log_ets => ra_log_ets,log_meta => ra_log_meta,log_sup => ra_log_sup,
          open_mem_tbls => ra_log_open_mem_tables,
          segment_writer => ra_log_segment_writer,
          server_sup => ra_server_sup_sup,wal => ra_log_wal,
          wal_sup => ra_log_wal_sup}},
    1,
    {wal,
        {file_descriptor,prim_file,
            #{handle => #Ref<0.4247252258.4035575831.45765>,
              owner => <0.542.0>,r_ahead_size => 0,
              r_buffer => #Ref<0.4247252258.4035575810.46203>}},
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
        {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
        131300186,8},
    1196,
    #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
    {batch,1,
        #{<0.554.0> =>
              {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,
                  #Ref<0.4247252258.4035575810.46294>,7,7,1,
                  [{7,1,
                    {'$usr',
                        #{from =>
                              {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                          ts => 1618308255090},
                        {write,<<"a">>,<<"2">>},
                        await_consensus}}]}},
        [[],
         <<64,0,0>>,
         <<44,43,42,54,0,0,0,154>>,
         [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
          <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,
            111,109,104,2,103,100,0,22,114,97,95,107,118,95,115,116,111,
            114,101,49,64,49,50,55,46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,
            114,0,3,100,0,22,114,97,95,107,118,95,115,116,111,114,101,49,
            64,49,50,55,46,48,46,48,46,49,3,0,0,239,108,240,136,0,1,253,39,
            237,34,100,0,2,116,115,110,6,0,114,77,176,202,120,1,104,3,100,
            0,5,119,114,105,116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,
            97,119,97,105,116,95,99,111,110,115,101,110,115,117,115>>]]}})

18:4:15.149531 <0.542.0> ra_log_wal:flush_pending({state,
    {conf,
        [raw,write,read,binary],
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,true,
        256000000,undefined,33554432,default,datasync,
        {atomics,#Ref<0.4247252258.4035575810.46192>},
        ra_log_open_mem_tables,ra_log_closed_mem_tables,
        #{closed_mem_tbls => ra_log_closed_mem_tables,
          directory => ra_directory,directory_rev => ra_directory_reverse,
          log_ets => ra_log_ets,log_meta => ra_log_meta,log_sup => ra_log_sup,
          open_mem_tbls => ra_log_open_mem_tables,
          segment_writer => ra_log_segment_writer,
          server_sup => ra_server_sup_sup,wal => ra_log_wal,
          wal_sup => ra_log_wal_sup}},
    1,
    {wal,
        {file_descriptor,prim_file,
            #{handle => #Ref<0.4247252258.4035575831.45765>,
              owner => <0.542.0>,r_ahead_size => 0,
              r_buffer => #Ref<0.4247252258.4035575810.46203>}},
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
        {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
        131300186,8},
    1196,
    #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
    {batch,1,
        #{<0.554.0> =>
              {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,
                  #Ref<0.4247252258.4035575810.46294>,7,7,1,
                  [{7,1,
                    {'$usr',
                        #{from =>
                              {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                          ts => 1618308255090},
                        {write,<<"a">>,<<"2">>},
                        await_consensus}}]}},
        [[],
         <<64,0,0>>,
         <<44,43,42,54,0,0,0,154>>,
         [<<0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,1>>,
          <<131,104,4,100,0,4,36,117,115,114,116,0,0,0,2,100,0,4,102,114,
            111,109,104,2,103,100,0,22,114,97,95,107,118,95,115,116,111,
            114,101,49,64,49,50,55,46,48,46,48,46,49,0,0,10,65,0,0,0,0,3,
            114,0,3,100,0,22,114,97,95,107,118,95,115,116,111,114,101,49,
            64,49,50,55,46,48,46,48,46,49,3,0,0,239,108,240,136,0,1,253,39,
            237,34,100,0,2,116,115,110,6,0,114,77,176,202,120,1,104,3,100,
            0,5,119,114,105,116,101,109,0,0,0,1,97,109,0,0,0,1,50,100,0,15,
            97,119,97,105,116,95,99,111,110,115,101,110,115,117,115>>]]}})

18:4:15.150726 <0.554.0> ra_server_proc:leader(cast, {{ra_kv2,'ra_kv_store2@127.0.0.1'},{append_entries_reply,1,true,8,7,1}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 6,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{7 =>
                    {7,1,
                     {'$usr',
                         #{from =>
                               {<0.2625.0>,
                                #Ref<0.4247252258.4035444737.61292>},
                           ts => 1618308255090},
                         {write,<<"a">>,<<"2">>},
                         await_consensus}}},
              undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0})

18:4:15.153302 <0.554.0> ra_server_proc:handle_leader({{ra_kv2,'ra_kv_store2@127.0.0.1'},{append_entries_reply,1,true,8,7,1}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 6,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{7 =>
                    {7,1,
                     {'$usr',
                         #{from =>
                               {<0.2625.0>,
                                #Ref<0.4247252258.4035444737.61292>},
                           ts => 1618308255090},
                         {write,<<"a">>,<<"2">>},
                         await_consensus}}},
              undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0})

18:4:15.155351 <0.554.0> ra_server:handle_leader({{ra_kv2,'ra_kv_store2@127.0.0.1'},{append_entries_reply,1,true,8,7,1}}, #{aux_state=>undefined, cfg=>{cfg,{ra_kv1,'ra_kv_store1@127.0.0.1'},
     <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
     {machine,ra_kv_store,#{}},
     0,
     [{0,0}],
     0,ra_kv_store,4096,
     {atomics,#Ref<0.4247252258.4035575810.46285>},
     #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",name => default,
       names =>
           #{closed_mem_tbls => ra_log_closed_mem_tables,
             directory => ra_directory,directory_rev => ra_directory_reverse,
             log_ets => ra_log_ets,log_meta => ra_log_meta,
             log_sup => ra_log_sup,open_mem_tbls => ra_log_open_mem_tables,
             segment_writer => ra_log_segment_writer,
             server_sup => ra_server_sup_sup,wal => ra_log_wal,
             wal_sup => ra_log_wal_sup},
       segment_max_entries => 4096,wal_compute_checksums => true,
       wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
       wal_max_batch_size => 8192,wal_max_entries => undefined,
       wal_max_size_bytes => 256000000,wal_sync_method => datasync,
       wal_write_strategy => default}}, cluster=>#{{ra_kv1,'ra_kv_store1@127.0.0.1'}=>#{commit_index_sent=>0, match_index=>0, next_index=>1, query_index=>0, status=>normal}, {ra_kv2,'ra_kv_store2@127.0.0.1'}=>#{commit_index_sent=>6, match_index=>6, next_index=>8, query_index=>0, status=>normal}}, cluster_change_permitted=>true, cluster_index_term=>{0,0}, commit_index=>6, commit_latency=>16, current_term=>1, last_applied=>6, leader_id=>{ra_kv1,'ra_kv_store1@127.0.0.1'}, log=>{ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
             4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
             {atomics,#Ref<0.4247252258.4035575810.46285>},
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
        0,7,1,
        {6,1},
        {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                     "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                     undefined,undefined,undefined},
        #{7 =>
              {7,1,
               {'$usr',#{from =>
                             {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                         ts => 1618308255090},
                       {write,<<"a">>,<<"2">>},
                       await_consensus}}},
        undefined,
        {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                            {atomics,#Ref<0.4247252258.4035575810.46285>},
                            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                            ra_log_open_mem_tables,ra_log_closed_mem_tables},
                       0,[],
                       {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
        []}, machine_state=>#{<<"a">>=><<"2">>}, pending_consistent_queries=>[], persisted_last_applied=>6, pre_vote_token=>#Ref<0.4247252258.4035444738.46318>, queries_waiting_heartbeats=>{[],[]}, query_index=>0, voted_for=>{ra_kv1,'ra_kv_store1@127.0.0.1'}})

18:4:15.156983 <0.554.0> ra_server:evaluate_quorum(#{aux_state=>undefined, cfg=>{cfg,{ra_kv1,'ra_kv_store1@127.0.0.1'},
     <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
     {machine,ra_kv_store,#{}},
     0,
     [{0,0}],
     0,ra_kv_store,4096,
     {atomics,#Ref<0.4247252258.4035575810.46285>},
     #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",name => default,
       names =>
           #{closed_mem_tbls => ra_log_closed_mem_tables,
             directory => ra_directory,directory_rev => ra_directory_reverse,
             log_ets => ra_log_ets,log_meta => ra_log_meta,
             log_sup => ra_log_sup,open_mem_tbls => ra_log_open_mem_tables,
             segment_writer => ra_log_segment_writer,
             server_sup => ra_server_sup_sup,wal => ra_log_wal,
             wal_sup => ra_log_wal_sup},
       segment_max_entries => 4096,wal_compute_checksums => true,
       wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
       wal_max_batch_size => 8192,wal_max_entries => undefined,
       wal_max_size_bytes => 256000000,wal_sync_method => datasync,
       wal_write_strategy => default}}, cluster=>#{{ra_kv1,'ra_kv_store1@127.0.0.1'}=>#{commit_index_sent=>0, match_index=>0, next_index=>1, query_index=>0, status=>normal}, {ra_kv2,'ra_kv_store2@127.0.0.1'}=>#{commit_index_sent=>6, match_index=>7, next_index=>8, query_index=>0, status=>normal}}, cluster_change_permitted=>true, cluster_index_term=>{0,0}, commit_index=>6, commit_latency=>16, current_term=>1, last_applied=>6, leader_id=>{ra_kv1,'ra_kv_store1@127.0.0.1'}, log=>{ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
             4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
             {atomics,#Ref<0.4247252258.4035575810.46285>},
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
        0,7,1,
        {6,1},
        {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                     "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                     undefined,undefined,undefined},
        #{7 =>
              {7,1,
               {'$usr',#{from =>
                             {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                         ts => 1618308255090},
                       {write,<<"a">>,<<"2">>},
                       await_consensus}}},
        undefined,
        {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                            {atomics,#Ref<0.4247252258.4035575810.46285>},
                            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                            ra_log_open_mem_tables,ra_log_closed_mem_tables},
                       0,[],
                       {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
        []}, machine_state=>#{<<"a">>=><<"2">>}, pending_consistent_queries=>[], persisted_last_applied=>6, pre_vote_token=>#Ref<0.4247252258.4035444738.46318>, queries_waiting_heartbeats=>{[],[]}, query_index=>0, voted_for=>{ra_kv1,'ra_kv_store1@127.0.0.1'}}, [])

18:4:15.158518 <0.554.0> ra_server:evaluate_quorum/2 --> {#{aux_state => undefined,
   cfg =>
       {cfg,
           {ra_kv1,'ra_kv_store1@127.0.0.1'},
           <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
           ra_kv1,
           {machine,ra_kv_store,#{}},
           0,
           [{0,0}],
           0,ra_kv_store,4096,
           {atomics,#Ref<0.4247252258.4035575810.46285>},
           #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
             name => default,
             names =>
                 #{closed_mem_tbls => ra_log_closed_mem_tables,
                   directory => ra_directory,
                   directory_rev => ra_directory_reverse,
                   log_ets => ra_log_ets,log_meta => ra_log_meta,
                   log_sup => ra_log_sup,
                   open_mem_tbls => ra_log_open_mem_tables,
                   segment_writer => ra_log_segment_writer,
                   server_sup => ra_server_sup_sup,wal => ra_log_wal,
                   wal_sup => ra_log_wal_sup},
             segment_max_entries => 4096,wal_compute_checksums => true,
             wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
             wal_max_batch_size => 8192,wal_max_entries => undefined,
             wal_max_size_bytes => 256000000,wal_sync_method => datasync,
             wal_write_strategy => default}},
   cluster =>
       #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
             #{commit_index_sent => 0,match_index => 0,next_index => 1,
               query_index => 0,status => normal},
         {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
             #{commit_index_sent => 6,match_index => 7,next_index => 8,
               query_index => 0,status => normal}},
   cluster_change_permitted => true,
   cluster_index_term => {0,0},
   commit_index => 6,commit_latency => 16,current_term => 1,last_applied => 6,
   leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
   log =>
       {ra_log,
           {cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
               "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
               4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
               {atomics,#Ref<0.4247252258.4035575810.46285>},
               #{closed_mem_tbls => ra_log_closed_mem_tables,
                 directory => ra_directory,
                 directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
                 log_meta => ra_log_meta,log_sup => ra_log_sup,
                 open_mem_tbls => ra_log_open_mem_tables,
                 segment_writer => ra_log_segment_writer,
                 server_sup => ra_server_sup_sup,wal => ra_log_wal,
                 wal_sup => ra_log_wal_sup}},
           0,7,1,
           {6,1},
           {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
               "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
               undefined,undefined,undefined},
           #{7 =>
                 {7,1,
                  {'$usr',
                      #{from =>
                            {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                        ts => 1618308255090},
                      {write,<<"a">>,<<"2">>},
                      await_consensus}}},
           undefined,
           {ra_log_reader,
               {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                   {atomics,#Ref<0.4247252258.4035575810.46285>},
                   "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                   ra_log_open_mem_tables,ra_log_closed_mem_tables},
               0,[],
               {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
           []},
   machine_state => #{<<"a">> => <<"2">>},
   pending_consistent_queries => [],persisted_last_applied => 6,
   pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
   queries_waiting_heartbeats => {[],[]},
   query_index => 0,
   voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
 []}

18:4:15.160039 <0.554.0> ra_server:handle_leader/2 --> {leader,
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{7 =>
                    {7,1,
                     {'$usr',
                         #{from =>
                               {<0.2625.0>,
                                #Ref<0.4247252258.4035444737.61292>},
                           ts => 1618308255090},
                         {write,<<"a">>,<<"2">>},
                         await_consensus}}},
              undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    []}

18:4:15.161814 <0.554.0> ra_server_proc:handle_leader/2 --> {leader,
    {state,
        {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,
            100,1000,30000,undefined,25,1000000,30000,1000,
            {atomics,#Ref<0.4247252258.4035575810.46285>}},
        #{aux_state => undefined,
          cfg =>
              {cfg,
                  {ra_kv1,'ra_kv_store1@127.0.0.1'},
                  <<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
                  {machine,ra_kv_store,#{}},
                  0,
                  [{0,0}],
                  0,ra_kv_store,4096,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                    name => default,
                    names =>
                        #{closed_mem_tbls => ra_log_closed_mem_tables,
                          directory => ra_directory,
                          directory_rev => ra_directory_reverse,
                          log_ets => ra_log_ets,log_meta => ra_log_meta,
                          log_sup => ra_log_sup,
                          open_mem_tbls => ra_log_open_mem_tables,
                          segment_writer => ra_log_segment_writer,
                          server_sup => ra_server_sup_sup,wal => ra_log_wal,
                          wal_sup => ra_log_wal_sup},
                    segment_max_entries => 4096,wal_compute_checksums => true,
                    wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                    wal_max_batch_size => 8192,wal_max_entries => undefined,
                    wal_max_size_bytes => 256000000,
                    wal_sync_method => datasync,
                    wal_write_strategy => default}},
          cluster =>
              #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                    #{commit_index_sent => 0,match_index => 0,next_index => 1,
                      query_index => 0,status => normal},
                {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                    #{commit_index_sent => 6,match_index => 7,next_index => 8,
                      query_index => 0,status => normal}},
          cluster_change_permitted => true,
          cluster_index_term => {0,0},
          commit_index => 6,commit_latency => 16,current_term => 1,
          last_applied => 6,
          leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
          log =>
              {ra_log,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      4096,ra_log_snapshot,20,ra_log_wal,
                      ra_log_segment_writer,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      #{closed_mem_tbls => ra_log_closed_mem_tables,
                        directory => ra_directory,
                        directory_rev => ra_directory_reverse,
                        log_ets => ra_log_ets,log_meta => ra_log_meta,
                        log_sup => ra_log_sup,
                        open_mem_tbls => ra_log_open_mem_tables,
                        segment_writer => ra_log_segment_writer,
                        server_sup => ra_server_sup_sup,wal => ra_log_wal,
                        wal_sup => ra_log_wal_sup}},
                  0,7,1,
                  {6,1},
                  {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                      undefined,undefined,undefined},
                  #{7 =>
                        {7,1,
                         {'$usr',
                             #{from =>
                                   {<0.2625.0>,
                                    #Ref<0.4247252258.4035444737.61292>},
                               ts => 1618308255090},
                             {write,<<"a">>,<<"2">>},
                             await_consensus}}},
                  undefined,
                  {ra_log_reader,
                      {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                          {atomics,#Ref<0.4247252258.4035575810.46285>},
                          "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                          ra_log_open_mem_tables,ra_log_closed_mem_tables},
                      0,[],
                      {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
                  []},
          machine_state => #{<<"a">> => <<"2">>},
          pending_consistent_queries => [],persisted_last_applied => 6,
          pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
          queries_waiting_heartbeats => {[],[]},
          query_index => 0,
          voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
        #{},[],undefined,undefined,
        {[],[]},
        false,0},
    []}

18:4:15.164379 <0.542.0> ra_log_wal:flush_pending/1 --> {state,
    {conf,
        [raw,write,read,binary],
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,true,
        256000000,undefined,33554432,default,datasync,
        {atomics,#Ref<0.4247252258.4035575810.46192>},
        ra_log_open_mem_tables,ra_log_closed_mem_tables,
        #{closed_mem_tbls => ra_log_closed_mem_tables,
          directory => ra_directory,directory_rev => ra_directory_reverse,
          log_ets => ra_log_ets,log_meta => ra_log_meta,log_sup => ra_log_sup,
          open_mem_tbls => ra_log_open_mem_tables,
          segment_writer => ra_log_segment_writer,
          server_sup => ra_server_sup_sup,wal => ra_log_wal,
          wal_sup => ra_log_wal_sup}},
    1,
    {wal,
        {file_descriptor,prim_file,
            #{handle => #Ref<0.4247252258.4035575831.45765>,
              owner => <0.542.0>,r_ahead_size => 0,
              r_buffer => #Ref<0.4247252258.4035575810.46203>}},
        "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
        {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
        131300186,8},
    1196,
    #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
    {batch,1,
        #{<0.554.0> =>
              {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,
                  #Ref<0.4247252258.4035575810.46294>,7,7,1,
                  [{7,1,
                    {'$usr',
                        #{from =>
                              {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                          ts => 1618308255090},
                        {write,<<"a">>,<<"2">>},
                        await_consensus}}]}},
        []}}

18:4:15.165178 <0.542.0> ra_log_wal:'-complete_batch/1-anonymous-0-'(<0.554.0>, {batch_writer,0,<<"RA_KV_4K9N2O5QOHEB">>,#Ref<0.4247252258.4035575810.46294>,
              7,7,1,
              [{7,1,
                {'$usr',#{from =>
                              {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                          ts => 1618308255090},
                        {write,<<"a">>,<<"2">>},
                        await_consensus}}]}, ra_log_open_mem_tables)

18:4:15.165493 <0.542.0> ra_log_wal:'-complete_batch/1-anonymous-0-'/3 --> ok

18:4:15.165565 <0.542.0> ra_log_wal:complete_batch/1 --> {state,{conf,[raw,write,read,binary],
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1",ra_log_segment_writer,
             true,256000000,undefined,33554432,default,datasync,
             {atomics,#Ref<0.4247252258.4035575810.46192>},
             ra_log_open_mem_tables,ra_log_closed_mem_tables,
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
       1,
       {wal,{file_descriptor,prim_file,
                             #{handle => #Ref<0.4247252258.4035575831.45765>,
                               owner => <0.542.0>,r_ahead_size => 0,
                               r_buffer =>
                                   #Ref<0.4247252258.4035575810.46203>}},
            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
            {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
            131300186,8},
       1196,
       #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
       undefined}

18:4:15.166112 <0.542.0> ra_log_wal:handle_batch/2 --> {ok,[garbage_collect],
    {state,{conf,[raw,write,read,binary],
                 "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                 ra_log_segment_writer,true,256000000,undefined,33554432,
                 default,datasync,
                 {atomics,#Ref<0.4247252258.4035575810.46192>},
                 ra_log_open_mem_tables,ra_log_closed_mem_tables,
                 #{closed_mem_tbls => ra_log_closed_mem_tables,
                   directory => ra_directory,
                   directory_rev => ra_directory_reverse,
                   log_ets => ra_log_ets,log_meta => ra_log_meta,
                   log_sup => ra_log_sup,
                   open_mem_tbls => ra_log_open_mem_tables,
                   segment_writer => ra_log_segment_writer,
                   server_sup => ra_server_sup_sup,wal => ra_log_wal,
                   wal_sup => ra_log_wal_sup}},
           1,
           {wal,{file_descriptor,prim_file,
                                 #{handle =>
                                       #Ref<0.4247252258.4035575831.45765>,
                                   owner => <0.542.0>,r_ahead_size => 0,
                                   r_buffer =>
                                       #Ref<0.4247252258.4035575810.46203>}},
                "/tmp/ra-release1/ra_kv_store1@127.0.0.1/00000001.wal",
                {1,#{<<"RA_KV_4K9N2O5QOHEB">> => <<128,0,0:7>>}},
                131300186,8},
           1196,
           #{<<"RA_KV_4K9N2O5QOHEB">> => {in_seq,7}},
           undefined}}

18:4:15.166772 <0.554.0> ra_server_proc:leader(info, {ra_log_event,{written,{7,7,1}}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{7 =>
                    {7,1,
                     {'$usr',
                         #{from =>
                               {<0.2625.0>,
                                #Ref<0.4247252258.4035444737.61292>},
                           ts => 1618308255090},
                         {write,<<"a">>,<<"2">>},
                         await_consensus}}},
              undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0})

18:4:15.168550 <0.554.0> ra_server_proc:handle_leader({ra_log_event,{written,{7,7,1}}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 6,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {6,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{7 =>
                    {7,1,
                     {'$usr',
                         #{from =>
                               {<0.2625.0>,
                                #Ref<0.4247252258.4035444737.61292>},
                           ts => 1618308255090},
                         {write,<<"a">>,<<"2">>},
                         await_consensus}}},
              undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0})

18:4:15.170357 <0.554.0> ra_server:handle_leader({ra_log_event,{written,{7,7,1}}}, #{aux_state=>undefined, cfg=>{cfg,{ra_kv1,'ra_kv_store1@127.0.0.1'},
     <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
     {machine,ra_kv_store,#{}},
     0,
     [{0,0}],
     0,ra_kv_store,4096,
     {atomics,#Ref<0.4247252258.4035575810.46285>},
     #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",name => default,
       names =>
           #{closed_mem_tbls => ra_log_closed_mem_tables,
             directory => ra_directory,directory_rev => ra_directory_reverse,
             log_ets => ra_log_ets,log_meta => ra_log_meta,
             log_sup => ra_log_sup,open_mem_tbls => ra_log_open_mem_tables,
             segment_writer => ra_log_segment_writer,
             server_sup => ra_server_sup_sup,wal => ra_log_wal,
             wal_sup => ra_log_wal_sup},
       segment_max_entries => 4096,wal_compute_checksums => true,
       wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
       wal_max_batch_size => 8192,wal_max_entries => undefined,
       wal_max_size_bytes => 256000000,wal_sync_method => datasync,
       wal_write_strategy => default}}, cluster=>#{{ra_kv1,'ra_kv_store1@127.0.0.1'}=>#{commit_index_sent=>0, match_index=>0, next_index=>1, query_index=>0, status=>normal}, {ra_kv2,'ra_kv_store2@127.0.0.1'}=>#{commit_index_sent=>6, match_index=>7, next_index=>8, query_index=>0, status=>normal}}, cluster_change_permitted=>true, cluster_index_term=>{0,0}, commit_index=>6, commit_latency=>16, current_term=>1, last_applied=>6, leader_id=>{ra_kv1,'ra_kv_store1@127.0.0.1'}, log=>{ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
             4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
             {atomics,#Ref<0.4247252258.4035575810.46285>},
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
        0,7,1,
        {6,1},
        {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                     "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                     undefined,undefined,undefined},
        #{7 =>
              {7,1,
               {'$usr',#{from =>
                             {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                         ts => 1618308255090},
                       {write,<<"a">>,<<"2">>},
                       await_consensus}}},
        undefined,
        {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                            {atomics,#Ref<0.4247252258.4035575810.46285>},
                            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                            ra_log_open_mem_tables,ra_log_closed_mem_tables},
                       0,[],
                       {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
        []}, machine_state=>#{<<"a">>=><<"2">>}, pending_consistent_queries=>[], persisted_last_applied=>6, pre_vote_token=>#Ref<0.4247252258.4035444738.46318>, queries_waiting_heartbeats=>{[],[]}, query_index=>0, voted_for=>{ra_kv1,'ra_kv_store1@127.0.0.1'}})

18:4:15.172380 <0.554.0> ra_log:handle_event({written,{7,7,1}}, {ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
             4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
             {atomics,#Ref<0.4247252258.4035575810.46285>},
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
        0,7,1,
        {6,1},
        {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                     "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                     undefined,undefined,undefined},
        #{7 =>
              {7,1,
               {'$usr',#{from =>
                             {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
                         ts => 1618308255090},
                       {write,<<"a">>,<<"2">>},
                       await_consensus}}},
        undefined,
        {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                            {atomics,#Ref<0.4247252258.4035575810.46285>},
                            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                            ra_log_open_mem_tables,ra_log_closed_mem_tables},
                       0,[],
                       {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
        []})

18:4:15.173197 <0.554.0> ra_log:handle_event/2 --> {{ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
              4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{closed_mem_tbls => ra_log_closed_mem_tables,
                directory => ra_directory,
                directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
                log_meta => ra_log_meta,log_sup => ra_log_sup,
                open_mem_tbls => ra_log_open_mem_tables,
                segment_writer => ra_log_segment_writer,
                server_sup => ra_server_sup_sup,wal => ra_log_wal,
                wal_sup => ra_log_wal_sup}},
         0,7,1,
         {7,1},
         {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                      undefined,undefined,undefined},
         #{},undefined,
         {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                             {atomics,#Ref<0.4247252258.4035575810.46285>},
                             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                             ra_log_open_mem_tables,ra_log_closed_mem_tables},
                        0,[],
                        {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
         []},
 []}

18:4:15.173767 <0.554.0> ra_server:evaluate_quorum(#{aux_state=>undefined, cfg=>{cfg,{ra_kv1,'ra_kv_store1@127.0.0.1'},
     <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
     {machine,ra_kv_store,#{}},
     0,
     [{0,0}],
     0,ra_kv_store,4096,
     {atomics,#Ref<0.4247252258.4035575810.46285>},
     #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",name => default,
       names =>
           #{closed_mem_tbls => ra_log_closed_mem_tables,
             directory => ra_directory,directory_rev => ra_directory_reverse,
             log_ets => ra_log_ets,log_meta => ra_log_meta,
             log_sup => ra_log_sup,open_mem_tbls => ra_log_open_mem_tables,
             segment_writer => ra_log_segment_writer,
             server_sup => ra_server_sup_sup,wal => ra_log_wal,
             wal_sup => ra_log_wal_sup},
       segment_max_entries => 4096,wal_compute_checksums => true,
       wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
       wal_max_batch_size => 8192,wal_max_entries => undefined,
       wal_max_size_bytes => 256000000,wal_sync_method => datasync,
       wal_write_strategy => default}}, cluster=>#{{ra_kv1,'ra_kv_store1@127.0.0.1'}=>#{commit_index_sent=>0, match_index=>0, next_index=>1, query_index=>0, status=>normal}, {ra_kv2,'ra_kv_store2@127.0.0.1'}=>#{commit_index_sent=>6, match_index=>7, next_index=>8, query_index=>0, status=>normal}}, cluster_change_permitted=>true, cluster_index_term=>{0,0}, commit_index=>6, commit_latency=>16, current_term=>1, last_applied=>6, leader_id=>{ra_kv1,'ra_kv_store1@127.0.0.1'}, log=>{ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
             4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
             {atomics,#Ref<0.4247252258.4035575810.46285>},
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
        0,7,1,
        {7,1},
        {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                     "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                     undefined,undefined,undefined},
        #{},undefined,
        {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                            {atomics,#Ref<0.4247252258.4035575810.46285>},
                            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                            ra_log_open_mem_tables,ra_log_closed_mem_tables},
                       0,[],
                       {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
        []}, machine_state=>#{<<"a">>=><<"2">>}, pending_consistent_queries=>[], persisted_last_applied=>6, pre_vote_token=>#Ref<0.4247252258.4035444738.46318>, queries_waiting_heartbeats=>{[],[]}, query_index=>0, voted_for=>{ra_kv1,'ra_kv_store1@127.0.0.1'}}, [])

18:4:15.175060 <0.554.0> ra_server:apply_with({7,1,
 {'$usr',#{from => {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
           ts => 1618308255090},
         {write,<<"a">>,<<"2">>},
         await_consensus}}, {ra_kv_store,6,
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 7,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {7,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{<<"a">> => <<"2">>},
    [{aux,eval}],
    #{},undefined})

18:4:15.176584 <0.554.0> ra_machine:apply(ra_kv_store, #{from=>{<0.2625.0>,#Ref<0.4247252258.4035444737.61292>}, index=>7, machine_version=>0, system_time=>1618308255090, term=>1}, {write,<<"a">>,<<"2">>}, #{<<"a">>=><<"2">>})

18:4:15.176747 <0.554.0> ra_kv_store:apply(#{from=>{<0.2625.0>,#Ref<0.4247252258.4035444737.61292>}, index=>7, machine_version=>0, system_time=>1618308255090, term=>1}, {write,<<"a">>,<<"2">>}, #{<<"a">>=><<"2">>})

18:4:15.176883 <0.554.0> ra_kv_store:side_effects(7, #{<<"a">>=><<"2">>})

18:4:15.176951 <0.554.0> ra_kv_store:side_effects/2 --> []

18:4:15.177014 <0.554.0> ra_kv_store:apply/3 --> {#{<<"a">> => <<"2">>},{7,1},[]}

18:4:15.177099 <0.554.0> ra_machine:apply/4 --> {#{<<"a">> => <<"2">>},{7,1},[]}

18:4:15.177225 <0.554.0> ra_server:apply_with/2 --> {ra_kv_store,7,
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 6,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 7,commit_latency => 16,current_term => 1,
      last_applied => 6,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {7,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{<<"a">> => <<"2">>},
    [[],
     {reply,
         {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
         {wrap_reply,{7,1}}},
     {aux,eval}],
    #{},1618308255090}

18:4:15.178765 <0.554.0> ra_server:evaluate_quorum/2 --> {#{aux_state => undefined,
   cfg =>
       {cfg,
           {ra_kv1,'ra_kv_store1@127.0.0.1'},
           <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
           ra_kv1,
           {machine,ra_kv_store,#{}},
           0,
           [{0,0}],
           0,ra_kv_store,4096,
           {atomics,#Ref<0.4247252258.4035575810.46285>},
           #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
             name => default,
             names =>
                 #{closed_mem_tbls => ra_log_closed_mem_tables,
                   directory => ra_directory,
                   directory_rev => ra_directory_reverse,
                   log_ets => ra_log_ets,log_meta => ra_log_meta,
                   log_sup => ra_log_sup,
                   open_mem_tbls => ra_log_open_mem_tables,
                   segment_writer => ra_log_segment_writer,
                   server_sup => ra_server_sup_sup,wal => ra_log_wal,
                   wal_sup => ra_log_wal_sup},
             segment_max_entries => 4096,wal_compute_checksums => true,
             wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
             wal_max_batch_size => 8192,wal_max_entries => undefined,
             wal_max_size_bytes => 256000000,wal_sync_method => datasync,
             wal_write_strategy => default}},
   cluster =>
       #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
             #{commit_index_sent => 0,match_index => 0,next_index => 1,
               query_index => 0,status => normal},
         {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
             #{commit_index_sent => 6,match_index => 7,next_index => 8,
               query_index => 0,status => normal}},
   cluster_change_permitted => true,
   cluster_index_term => {0,0},
   commit_index => 7,commit_latency => 16,current_term => 1,last_applied => 7,
   leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
   log =>
       {ra_log,
           {cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
               "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
               4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
               {atomics,#Ref<0.4247252258.4035575810.46285>},
               #{closed_mem_tbls => ra_log_closed_mem_tables,
                 directory => ra_directory,
                 directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
                 log_meta => ra_log_meta,log_sup => ra_log_sup,
                 open_mem_tbls => ra_log_open_mem_tables,
                 segment_writer => ra_log_segment_writer,
                 server_sup => ra_server_sup_sup,wal => ra_log_wal,
                 wal_sup => ra_log_wal_sup}},
           0,7,1,
           {7,1},
           {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
               "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
               undefined,undefined,undefined},
           #{},undefined,
           {ra_log_reader,
               {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                   {atomics,#Ref<0.4247252258.4035575810.46285>},
                   "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                   ra_log_open_mem_tables,ra_log_closed_mem_tables},
               0,[],
               {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
           []},
   machine_state => #{<<"a">> => <<"2">>},
   pending_consistent_queries => [],persisted_last_applied => 6,
   pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
   queries_waiting_heartbeats => {[],[]},
   query_index => 0,
   voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
 [{aux,eval},
  {reply,{<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},{wrap_reply,{7,1}}},
  []]}

18:4:15.180157 <0.554.0> ra_server:handle_leader/2 --> {leader,
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 7,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 7,commit_latency => 16,current_term => 1,
      last_applied => 7,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {7,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 6,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    [{send_rpc,
         {ra_kv2,'ra_kv_store2@127.0.0.1'},
         {append_entries_rpc,1,{ra_kv1,'ra_kv_store1@127.0.0.1'},7,7,1,[]}},
     {aux,eval},
     {reply,
         {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
         {wrap_reply,{7,1}}},
     []]}

18:4:15.181892 <0.554.0> ra_server_proc:handle_leader/2 --> {leader,
    {state,
        {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,
            100,1000,30000,undefined,25,1000000,30000,1000,
            {atomics,#Ref<0.4247252258.4035575810.46285>}},
        #{aux_state => undefined,
          cfg =>
              {cfg,
                  {ra_kv1,'ra_kv_store1@127.0.0.1'},
                  <<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
                  {machine,ra_kv_store,#{}},
                  0,
                  [{0,0}],
                  0,ra_kv_store,4096,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                    name => default,
                    names =>
                        #{closed_mem_tbls => ra_log_closed_mem_tables,
                          directory => ra_directory,
                          directory_rev => ra_directory_reverse,
                          log_ets => ra_log_ets,log_meta => ra_log_meta,
                          log_sup => ra_log_sup,
                          open_mem_tbls => ra_log_open_mem_tables,
                          segment_writer => ra_log_segment_writer,
                          server_sup => ra_server_sup_sup,wal => ra_log_wal,
                          wal_sup => ra_log_wal_sup},
                    segment_max_entries => 4096,wal_compute_checksums => true,
                    wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                    wal_max_batch_size => 8192,wal_max_entries => undefined,
                    wal_max_size_bytes => 256000000,
                    wal_sync_method => datasync,
                    wal_write_strategy => default}},
          cluster =>
              #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                    #{commit_index_sent => 0,match_index => 0,next_index => 1,
                      query_index => 0,status => normal},
                {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                    #{commit_index_sent => 7,match_index => 7,next_index => 8,
                      query_index => 0,status => normal}},
          cluster_change_permitted => true,
          cluster_index_term => {0,0},
          commit_index => 7,commit_latency => 16,current_term => 1,
          last_applied => 7,
          leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
          log =>
              {ra_log,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      4096,ra_log_snapshot,20,ra_log_wal,
                      ra_log_segment_writer,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      #{closed_mem_tbls => ra_log_closed_mem_tables,
                        directory => ra_directory,
                        directory_rev => ra_directory_reverse,
                        log_ets => ra_log_ets,log_meta => ra_log_meta,
                        log_sup => ra_log_sup,
                        open_mem_tbls => ra_log_open_mem_tables,
                        segment_writer => ra_log_segment_writer,
                        server_sup => ra_server_sup_sup,wal => ra_log_wal,
                        wal_sup => ra_log_wal_sup}},
                  0,7,1,
                  {7,1},
                  {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                      undefined,undefined,undefined},
                  #{},undefined,
                  {ra_log_reader,
                      {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                          {atomics,#Ref<0.4247252258.4035575810.46285>},
                          "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                          ra_log_open_mem_tables,ra_log_closed_mem_tables},
                      0,[],
                      {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
                  []},
          machine_state => #{<<"a">> => <<"2">>},
          pending_consistent_queries => [],persisted_last_applied => 7,
          pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
          queries_waiting_heartbeats => {[],[]},
          query_index => 0,
          voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
        #{},[],undefined,undefined,
        {[],[]},
        false,0},
    [{send_rpc,
         {ra_kv2,'ra_kv_store2@127.0.0.1'},
         {append_entries_rpc,1,{ra_kv1,'ra_kv_store1@127.0.0.1'},7,7,1,[]}},
     {aux,eval},
     {reply,
         {<0.2625.0>,#Ref<0.4247252258.4035444737.61292>},
         {wrap_reply,{7,1}}},
     []]}

18:4:15.184588 <0.554.0> ra_server_proc:handle_effect(leader, {send_rpc,{ra_kv2,'ra_kv_store2@127.0.0.1'},
          {append_entries_rpc,1,{ra_kv1,'ra_kv_store1@127.0.0.1'},7,7,1,[]}}, info, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 7,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 7,commit_latency => 16,current_term => 1,
      last_applied => 7,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {7,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 7,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0}, [])

18:4:15.186333 <0.554.0> ra_server_proc:send({ra_kv2,'ra_kv_store2@127.0.0.1'}, {'$gen_cast',{append_entries_rpc,1,
                                 {ra_kv1,'ra_kv_store1@127.0.0.1'},
                                 7,7,1,[]}}, {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,1000,
      30000,undefined,25,1000000,30000,1000,
      {atomics,#Ref<0.4247252258.4035575810.46285>}})

18:4:15.186593 <0.554.0> ra_server_proc:send/3 --> ok

18:4:15.186656 <0.2624.0> ra_server_proc:gen_statem_safe_call/3 --> {wrap_reply,{7,1}}

18:4:15.186727 <0.2624.0> ra_server_proc:leader_call/3 --> {ok,{7,1},ra_kv1}

18:4:15.186807 <0.2624.0> ra_server_proc:command/3 --> {ok,{7,1},ra_kv1}

18:4:15.186883 <0.2624.0> ra:process_command/3 --> {ok,{7,1},ra_kv1}

18:4:15.186950 <0.2624.0> ra:process_command/2 --> {ok,{7,1},ra_kv1}

18:4:15.187014 <0.2624.0> ra_kv_store:write/3 --> {ok,{{index,7},{term,1},{leader,ra_kv1}}}

18:4:15.187097 <0.554.0> ra_server_proc:leader(cast, {{ra_kv2,'ra_kv_store2@127.0.0.1'},{append_entries_reply,1,true,8,7,1}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 7,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 7,commit_latency => 16,current_term => 1,
      last_applied => 7,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {7,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 7,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0})

18:4:15.188665 <0.554.0> ra_server_proc:handle_leader({{ra_kv2,'ra_kv_store2@127.0.0.1'},{append_entries_reply,1,true,8,7,1}}, {state,
    {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,100,
        1000,30000,undefined,25,1000000,30000,1000,
        {atomics,#Ref<0.4247252258.4035575810.46285>}},
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 7,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 7,commit_latency => 16,current_term => 1,
      last_applied => 7,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {7,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 7,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    #{},[],undefined,undefined,
    {[],[]},
    false,0})

18:4:15.190280 <0.554.0> ra_server:handle_leader({{ra_kv2,'ra_kv_store2@127.0.0.1'},{append_entries_reply,1,true,8,7,1}}, #{aux_state=>undefined, cfg=>{cfg,{ra_kv1,'ra_kv_store1@127.0.0.1'},
     <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
     {machine,ra_kv_store,#{}},
     0,
     [{0,0}],
     0,ra_kv_store,4096,
     {atomics,#Ref<0.4247252258.4035575810.46285>},
     #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",name => default,
       names =>
           #{closed_mem_tbls => ra_log_closed_mem_tables,
             directory => ra_directory,directory_rev => ra_directory_reverse,
             log_ets => ra_log_ets,log_meta => ra_log_meta,
             log_sup => ra_log_sup,open_mem_tbls => ra_log_open_mem_tables,
             segment_writer => ra_log_segment_writer,
             server_sup => ra_server_sup_sup,wal => ra_log_wal,
             wal_sup => ra_log_wal_sup},
       segment_max_entries => 4096,wal_compute_checksums => true,
       wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
       wal_max_batch_size => 8192,wal_max_entries => undefined,
       wal_max_size_bytes => 256000000,wal_sync_method => datasync,
       wal_write_strategy => default}}, cluster=>#{{ra_kv1,'ra_kv_store1@127.0.0.1'}=>#{commit_index_sent=>0, match_index=>0, next_index=>1, query_index=>0, status=>normal}, {ra_kv2,'ra_kv_store2@127.0.0.1'}=>#{commit_index_sent=>7, match_index=>7, next_index=>8, query_index=>0, status=>normal}}, cluster_change_permitted=>true, cluster_index_term=>{0,0}, commit_index=>7, commit_latency=>16, current_term=>1, last_applied=>7, leader_id=>{ra_kv1,'ra_kv_store1@127.0.0.1'}, log=>{ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
             4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
             {atomics,#Ref<0.4247252258.4035575810.46285>},
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
        0,7,1,
        {7,1},
        {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                     "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                     undefined,undefined,undefined},
        #{},undefined,
        {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                            {atomics,#Ref<0.4247252258.4035575810.46285>},
                            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                            ra_log_open_mem_tables,ra_log_closed_mem_tables},
                       0,[],
                       {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
        []}, machine_state=>#{<<"a">>=><<"2">>}, pending_consistent_queries=>[], persisted_last_applied=>7, pre_vote_token=>#Ref<0.4247252258.4035444738.46318>, queries_waiting_heartbeats=>{[],[]}, query_index=>0, voted_for=>{ra_kv1,'ra_kv_store1@127.0.0.1'}})

18:4:15.191588 <0.554.0> ra_server:evaluate_quorum(#{aux_state=>undefined, cfg=>{cfg,{ra_kv1,'ra_kv_store1@127.0.0.1'},
     <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
     {machine,ra_kv_store,#{}},
     0,
     [{0,0}],
     0,ra_kv_store,4096,
     {atomics,#Ref<0.4247252258.4035575810.46285>},
     #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",name => default,
       names =>
           #{closed_mem_tbls => ra_log_closed_mem_tables,
             directory => ra_directory,directory_rev => ra_directory_reverse,
             log_ets => ra_log_ets,log_meta => ra_log_meta,
             log_sup => ra_log_sup,open_mem_tbls => ra_log_open_mem_tables,
             segment_writer => ra_log_segment_writer,
             server_sup => ra_server_sup_sup,wal => ra_log_wal,
             wal_sup => ra_log_wal_sup},
       segment_max_entries => 4096,wal_compute_checksums => true,
       wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
       wal_max_batch_size => 8192,wal_max_entries => undefined,
       wal_max_size_bytes => 256000000,wal_sync_method => datasync,
       wal_write_strategy => default}}, cluster=>#{{ra_kv1,'ra_kv_store1@127.0.0.1'}=>#{commit_index_sent=>0, match_index=>0, next_index=>1, query_index=>0, status=>normal}, {ra_kv2,'ra_kv_store2@127.0.0.1'}=>#{commit_index_sent=>7, match_index=>7, next_index=>8, query_index=>0, status=>normal}}, cluster_change_permitted=>true, cluster_index_term=>{0,0}, commit_index=>7, commit_latency=>16, current_term=>1, last_applied=>7, leader_id=>{ra_kv1,'ra_kv_store1@127.0.0.1'}, log=>{ra_log,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
             "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
             4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
             {atomics,#Ref<0.4247252258.4035575810.46285>},
             #{closed_mem_tbls => ra_log_closed_mem_tables,
               directory => ra_directory,
               directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
               log_meta => ra_log_meta,log_sup => ra_log_sup,
               open_mem_tbls => ra_log_open_mem_tables,
               segment_writer => ra_log_segment_writer,
               server_sup => ra_server_sup_sup,wal => ra_log_wal,
               wal_sup => ra_log_wal_sup}},
        0,7,1,
        {7,1},
        {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                     "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                     undefined,undefined,undefined},
        #{},undefined,
        {ra_log_reader,{cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                            {atomics,#Ref<0.4247252258.4035575810.46285>},
                            "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                            ra_log_open_mem_tables,ra_log_closed_mem_tables},
                       0,[],
                       {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
        []}, machine_state=>#{<<"a">>=><<"2">>}, pending_consistent_queries=>[], persisted_last_applied=>7, pre_vote_token=>#Ref<0.4247252258.4035444738.46318>, queries_waiting_heartbeats=>{[],[]}, query_index=>0, voted_for=>{ra_kv1,'ra_kv_store1@127.0.0.1'}}, [])

18:4:15.192885 <0.554.0> ra_server:evaluate_quorum/2 --> {#{aux_state => undefined,
   cfg =>
       {cfg,
           {ra_kv1,'ra_kv_store1@127.0.0.1'},
           <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
           ra_kv1,
           {machine,ra_kv_store,#{}},
           0,
           [{0,0}],
           0,ra_kv_store,4096,
           {atomics,#Ref<0.4247252258.4035575810.46285>},
           #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
             name => default,
             names =>
                 #{closed_mem_tbls => ra_log_closed_mem_tables,
                   directory => ra_directory,
                   directory_rev => ra_directory_reverse,
                   log_ets => ra_log_ets,log_meta => ra_log_meta,
                   log_sup => ra_log_sup,
                   open_mem_tbls => ra_log_open_mem_tables,
                   segment_writer => ra_log_segment_writer,
                   server_sup => ra_server_sup_sup,wal => ra_log_wal,
                   wal_sup => ra_log_wal_sup},
             segment_max_entries => 4096,wal_compute_checksums => true,
             wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
             wal_max_batch_size => 8192,wal_max_entries => undefined,
             wal_max_size_bytes => 256000000,wal_sync_method => datasync,
             wal_write_strategy => default}},
   cluster =>
       #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
             #{commit_index_sent => 0,match_index => 0,next_index => 1,
               query_index => 0,status => normal},
         {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
             #{commit_index_sent => 7,match_index => 7,next_index => 8,
               query_index => 0,status => normal}},
   cluster_change_permitted => true,
   cluster_index_term => {0,0},
   commit_index => 7,commit_latency => 16,current_term => 1,last_applied => 7,
   leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
   log =>
       {ra_log,
           {cfg,<<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
               "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
               4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
               {atomics,#Ref<0.4247252258.4035575810.46285>},
               #{closed_mem_tbls => ra_log_closed_mem_tables,
                 directory => ra_directory,
                 directory_rev => ra_directory_reverse,log_ets => ra_log_ets,
                 log_meta => ra_log_meta,log_sup => ra_log_sup,
                 open_mem_tbls => ra_log_open_mem_tables,
                 segment_writer => ra_log_segment_writer,
                 server_sup => ra_server_sup_sup,wal => ra_log_wal,
                 wal_sup => ra_log_wal_sup}},
           0,7,1,
           {7,1},
           {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
               "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
               undefined,undefined,undefined},
           #{},undefined,
           {ra_log_reader,
               {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                   {atomics,#Ref<0.4247252258.4035575810.46285>},
                   "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                   ra_log_open_mem_tables,ra_log_closed_mem_tables},
               0,[],
               {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
           []},
   machine_state => #{<<"a">> => <<"2">>},
   pending_consistent_queries => [],persisted_last_applied => 7,
   pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
   queries_waiting_heartbeats => {[],[]},
   query_index => 0,
   voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
 []}

18:4:15.194272 <0.554.0> ra_server:handle_leader/2 --> {leader,
    #{aux_state => undefined,
      cfg =>
          {cfg,
              {ra_kv1,'ra_kv_store1@127.0.0.1'},
              <<"RA_KV_4K9N2O5QOHEB">>,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",
              ra_kv1,
              {machine,ra_kv_store,#{}},
              0,
              [{0,0}],
              0,ra_kv_store,4096,
              {atomics,#Ref<0.4247252258.4035575810.46285>},
              #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                name => default,
                names =>
                    #{closed_mem_tbls => ra_log_closed_mem_tables,
                      directory => ra_directory,
                      directory_rev => ra_directory_reverse,
                      log_ets => ra_log_ets,log_meta => ra_log_meta,
                      log_sup => ra_log_sup,
                      open_mem_tbls => ra_log_open_mem_tables,
                      segment_writer => ra_log_segment_writer,
                      server_sup => ra_server_sup_sup,wal => ra_log_wal,
                      wal_sup => ra_log_wal_sup},
                segment_max_entries => 4096,wal_compute_checksums => true,
                wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                wal_max_batch_size => 8192,wal_max_entries => undefined,
                wal_max_size_bytes => 256000000,wal_sync_method => datasync,
                wal_write_strategy => default}},
      cluster =>
          #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                #{commit_index_sent => 0,match_index => 0,next_index => 1,
                  query_index => 0,status => normal},
            {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                #{commit_index_sent => 7,match_index => 7,next_index => 8,
                  query_index => 0,status => normal}},
      cluster_change_permitted => true,
      cluster_index_term => {0,0},
      commit_index => 7,commit_latency => 16,current_term => 1,
      last_applied => 7,
      leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
      log =>
          {ra_log,
              {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                  4096,ra_log_snapshot,20,ra_log_wal,ra_log_segment_writer,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{closed_mem_tbls => ra_log_closed_mem_tables,
                    directory => ra_directory,
                    directory_rev => ra_directory_reverse,
                    log_ets => ra_log_ets,log_meta => ra_log_meta,
                    log_sup => ra_log_sup,
                    open_mem_tbls => ra_log_open_mem_tables,
                    segment_writer => ra_log_segment_writer,
                    server_sup => ra_server_sup_sup,wal => ra_log_wal,
                    wal_sup => ra_log_wal_sup}},
              0,7,1,
              {7,1},
              {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                  "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                  undefined,undefined,undefined},
              #{},undefined,
              {ra_log_reader,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      ra_log_open_mem_tables,ra_log_closed_mem_tables},
                  0,[],
                  {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
              []},
      machine_state => #{<<"a">> => <<"2">>},
      pending_consistent_queries => [],persisted_last_applied => 7,
      pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
      queries_waiting_heartbeats => {[],[]},
      query_index => 0,
      voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
    []}

18:4:15.195838 <0.554.0> ra_server_proc:handle_leader/2 --> {leader,
    {state,
        {conf,"{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,<<"ra_kv_store">>,
            100,1000,30000,undefined,25,1000000,30000,1000,
            {atomics,#Ref<0.4247252258.4035575810.46285>}},
        #{aux_state => undefined,
          cfg =>
              {cfg,
                  {ra_kv1,'ra_kv_store1@127.0.0.1'},
                  <<"RA_KV_4K9N2O5QOHEB">>,
                  "{ra_kv1,'ra_kv_store1@127.0.0.1'}",ra_kv1,
                  {machine,ra_kv_store,#{}},
                  0,
                  [{0,0}],
                  0,ra_kv_store,4096,
                  {atomics,#Ref<0.4247252258.4035575810.46285>},
                  #{data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                    name => default,
                    names =>
                        #{closed_mem_tbls => ra_log_closed_mem_tables,
                          directory => ra_directory,
                          directory_rev => ra_directory_reverse,
                          log_ets => ra_log_ets,log_meta => ra_log_meta,
                          log_sup => ra_log_sup,
                          open_mem_tbls => ra_log_open_mem_tables,
                          segment_writer => ra_log_segment_writer,
                          server_sup => ra_server_sup_sup,wal => ra_log_wal,
                          wal_sup => ra_log_wal_sup},
                    segment_max_entries => 4096,wal_compute_checksums => true,
                    wal_data_dir => "/tmp/ra-release1/ra_kv_store1@127.0.0.1",
                    wal_max_batch_size => 8192,wal_max_entries => undefined,
                    wal_max_size_bytes => 256000000,
                    wal_sync_method => datasync,
                    wal_write_strategy => default}},
          cluster =>
              #{{ra_kv1,'ra_kv_store1@127.0.0.1'} =>
                    #{commit_index_sent => 0,match_index => 0,next_index => 1,
                      query_index => 0,status => normal},
                {ra_kv2,'ra_kv_store2@127.0.0.1'} =>
                    #{commit_index_sent => 7,match_index => 7,next_index => 8,
                      query_index => 0,status => normal}},
          cluster_change_permitted => true,
          cluster_index_term => {0,0},
          commit_index => 7,commit_latency => 16,current_term => 1,
          last_applied => 7,
          leader_id => {ra_kv1,'ra_kv_store1@127.0.0.1'},
          log =>
              {ra_log,
                  {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                      "{ra_kv1,'ra_kv_store1@127.0.0.1'}",
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                      4096,ra_log_snapshot,20,ra_log_wal,
                      ra_log_segment_writer,
                      {atomics,#Ref<0.4247252258.4035575810.46285>},
                      #{closed_mem_tbls => ra_log_closed_mem_tables,
                        directory => ra_directory,
                        directory_rev => ra_directory_reverse,
                        log_ets => ra_log_ets,log_meta => ra_log_meta,
                        log_sup => ra_log_sup,
                        open_mem_tbls => ra_log_open_mem_tables,
                        segment_writer => ra_log_segment_writer,
                        server_sup => ra_server_sup_sup,wal => ra_log_wal,
                        wal_sup => ra_log_wal_sup}},
                  0,7,1,
                  {7,1},
                  {ra_snapshot,<<"RA_KV_4K9N2O5QOHEB">>,ra_log_snapshot,
                      "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB/snapshots",
                      undefined,undefined,undefined},
                  #{},undefined,
                  {ra_log_reader,
                      {cfg,<<"RA_KV_4K9N2O5QOHEB">>,
                          {atomics,#Ref<0.4247252258.4035575810.46285>},
                          "/tmp/ra-release1/ra_kv_store1@127.0.0.1/RA_KV_4K9N2O5QOHEB",
                          ra_log_open_mem_tables,ra_log_closed_mem_tables},
                      0,[],
                      {ra_flru,3,[],#Fun<ra_log_reader.0.96270836>}},
                  []},
          machine_state => #{<<"a">> => <<"2">>},
          pending_consistent_queries => [],persisted_last_applied => 7,
          pre_vote_token => #Ref<0.4247252258.4035444738.46318>,
          queries_waiting_heartbeats => {[],[]},
          query_index => 0,
          voted_for => {ra_kv1,'ra_kv_store1@127.0.0.1'}},
        #{},[],undefined,undefined,
        {[],[]},
        false,0},
    []}
```